<!-- route.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WhereTo | Jeepney Route Finder</title>
  <link rel="icon" href="/WTFavicon.png" type="image/png">
  <link rel="stylesheet" href="navigation.css" />
</head>
<body>
  <!-- ===== HEADER ===== -->
  <header>
    <div class="header-left">
      <img src="compass.PNG" alt="Compass" class="icon" />
      <img src="Logo.PNG" alt="WhereTo Logo" class="logo" />
    </div>
  </header>

  <!-- Main Route Display -->
  <% if (error) { %>
    <div class="big-box">
      <h1>Error</h1>
      <p><%= error %></p>
    </div>
  <% } else if (routes && routes.length > 0) { %>
    <% routes.forEach((route, index) => { %>
      <div class="big-box">
        <h1 id="routeTitle"><%= route.name %> (<%= route.status %>)</h1>
        <div class="route-meta">
          <span class="meta-time">Estimated travel time: <%= route.travelTime || 'N/A' %></span>
          <span class="meta-fare">Estimated Fare: â‚±<%= route.fare != null ? route.fare : 'N/A' %></span>
  </div>
        <div class="small-box">
          <button class="nav-btn" onclick="startNavigation(<%= index %>)">
            <span>Start Navigation</span>
          </button>
        </div>
      </div>

      <div class="big-box second">
        <h1>Directions for <%= route.name %></h1>
        <% if (route.steps && route.steps.length > 0) { %>
          <% route.steps.forEach((step, stepIndex) => { %>
            <div class="small-box">
            
              <span>Step <%= stepIndex + 1 %>.</span>
              <p><%= step %></p>
            </div>
          <% }); %>
        <% } else { %>
          <div class="small-box">
            <p>No detailed steps available for this route.</p>
          </div>
        <% } %>
      </div>
    <% }); %>
  <% } else { %>
    <div class="big-box">
      <h1>No Routes Found</h1>
      <p>No routes available from <%= from %> to <%= to %>. Please try a different search or check back later.</p>
    </div>
  <% } %>

  <!-- Route Alerts (kept as is, or customize) 
  <div class="big-box third">
    <h1>Route Alerts</h1>
    <div class="small-box">

      <span>Route tip</span>
      <p>During rush hours...</p>
    </div>
  </div>-->

  <!-- ===== WHITE CONTENT AREA ===== -->
  <section class="content-section">
    <div class="buttons-row">
      <button class="info-btn" onclick="window.location.href='/LiveMap'">
        <img src="map.png" alt="Routes" />
        <span>Live Map</span>
      </button>
      <button class="info-btn" onclick="window.location.href='/destination'">
        <img src="route.png" alt="Alter" />
        <span>Find Alternative</span>
      </button>
    </div>
  </section>

  <!-- Script to pass selected route to navigation via localStorage -->
  <script>
    // Inject server-side route data into client JS
    const _routeOptions = <%- JSON.stringify(routes || []) %>;
    const _from = "<%= from || '' %>";
    const _to = "<%= to || '' %>";

    function startNavigation(index) {
      const sel = _routeOptions[index] || {};
      const recent = [{
        from: _from,
        to: _to,
        routeName: sel.name || '',
        steps: sel.steps || [],
        status: sel.status || '',
        fare: sel.fare || '',
        travelTime: sel.travelTime || ''
      }];
      try {
        localStorage.setItem('recentSearches', JSON.stringify(recent));
      } catch (e) {
        console.error('Failed to save recentSearches', e);
      }
      window.location.href = '/nav';
    }
  </script>

</body>
</html>