<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="LiveMap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  </head>

  <body>
    <header class="top-bar">
      <button class="back-btn" onclick="history.back()">‚Üê</button>
      <h2>Live Map</h2>
    </header>

    <div class="map_container">
      <!-- iframe starts empty; src will be set from LOCATION_API -->
      <iframe id="mapFrame" width="100%" height="70vh" style="border:0" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>

    <div class="legend_container">
      <div class="legend-item"><span class="red dot"></span>Your location</div>
      <div class="legend-item"><span class="blue dot"></span>Terminal</div>
      <div class="legend-item"><span class="yellow dot"></span>Point A</div>
      <div class="legend-item"><span class="dark-green dot"></span>Point B</div>
    </div>

    <div class="buttons">
      <button class="search-btn"><i class="fa fa-search"></i> SEARCH ROUTE</button>
      <button class="report-btn"><i class="fa fa-exclamation-triangle"></i> REPORT ISSUE</button>
    </div>

    <div class="location_container">
      <div class="legend-item"><span class="green dot"></span>Live location</div>
    </div>

    <script>
      // Change this to your location API (can be absolute URL)
      const LOCATION_API = '/api/location';

      const iframe = document.getElementById('mapFrame');

      async function loadMap() {
  try {
    const res = await fetch(LOCATION_API);
    if (!res.ok) throw new Error('Location API returned ' + res.status);
    const data = await res.json();

    const { lat, lng, zoom = 5, embedUrl } = data;

    let src;
    if (embedUrl) {
      src = embedUrl;
    } else if (lat != null && lng != null) {
      // MapTiler Hybrid map format
      src = `https://api.maptiler.com/maps/hybrid/?key=7gC1ycjhdrekilmBwtUi#${zoom}/${lat}/${lng}`;
    } else {
      throw new Error('Invalid location response');
    }

    iframe.src = src;
  } catch (err) {
    console.error('Failed to load location:', err);
    // fallback to a default MapTiler view
    iframe.src = 'https://api.maptiler.com/maps/hybrid/?key=7gC1ycjhdrekilmBwtUi#5.0/13.40503/120.59931';
  }
}

      loadMap();
    </script>
  </body>
</html>