<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>WhereTo | Profile</title>
    <link rel="icon" href="/WTFavicon.png" type="image/png">
    <link rel="stylesheet" href="profile.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <div class="header-left">
            <img src="Back.png" alt="Back" class="icon back-icon" onclick="history.back()">
            <span>Profile</span>
        </div>
    </header>

    <section class="main-content">
        <!-- User Profile Card -->
        <div class="profile-card">
            <div class="user-info">
                <div class="user-avatar">
                    <!-- note: class "avatar-img" used by JS to set src on both pages -->
                    <img src="user.png" alt="User Avatar" class="avatar-img" id="mainAvatar">
                </div>
                <div class="user-details">
                    <h2 id="displayName">User</h2>
                    <p id="displayEmail">latciass....</p>
                </div>
            </div>
            <div class="community-rating">
                <img src="star.png" alt="Star" class="star-icon">
                <span class="rating">4.8</span>
                <span class="rating-text">community rating</span>
            </div>
            <div class="user-stats">
                <div class="stat-item">
                    <img src="route.png" alt="Trips" class="stat-icon">
                    <span class="stat-number">47</span>
                    <span class="stat-label">trips taken</span>
                </div>
                <div class="stat-item">
                    <img src="favorites.png" alt="Saved" class="stat-icon">
                    <span class="stat-number">3</span>
                    <span class="stat-label">saved routes</span>
                </div>
                <div class="stat-item">
                    <img src="report.png" alt="Reports" class="stat-icon">
                    <span class="stat-number">10</span>
                    <span class="stat-label">reports made</span>
                </div>
            </div>
        </div>

        <!-- Edit Button -->
        <div style="text-align: center; margin: 15px 0;">
            <button class="edit-profile-btn" onclick="goToNextPage()">
                <img src="edit.png" alt="Edit" class="edit-icon">
                <span>Edit Profile</span>
            </button>
        </div>

        <!-- Preferences Section -->
        <div class="content-section preferences">
            <div class="section-header">
                <img src="settings.png" alt="Settings" class="section-icon">
                <h2>Preferences</h2>
            </div>
            <div class="preference-item">
                <div class="preference-info">
                    <span class="preference-title">Push notifications</span>
                    <span class="preference-desc">receive alerts and updates</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="notifications">  <!-- Removed 'disabled' -->
                    <span class="slider"></span>
                </label>
            </div>
            <div class="preference-item">
                <div class="preference-info">
                    <span class="preference-title">Auto-save Routes</span>
                    <span class="preference-desc">Automatically save frequently used route</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="autoSave">  <!-- Removed 'disabled' -->
                    <span class="slider"></span>
                </label>
            </div>
            <div class="preference-item">
                <div class="preference-info">
                    <span class="preference-title">Offline Mode</span>
                    <span class="preference-desc">download routes for offline use</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="offline">  <!-- Removed 'disabled' -->
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- Saved Routes Section -->
        <div class="content-section saved-routes">
            <div class="section-header">
                <img src="favorites.png" alt="Saved" class="section-icon">
                <h2>Saved Routes</h2>
            </div>
            <div class="route-item">
                <div class="route-info">
                    <img src="pin.png" alt="Location" class="route-icon">
                    <div class="route-details">
                        <span class="route-name">Home to Work</span>
                        <span class="route-path">Divisoria → Cubao</span>
                        <span class="route-last-used">last used: Today</span>
                    </div>
                </div>
                <div class="route-actions">
                    <button class="action-btn use-btn" disabled>use</button>
                    <button class="action-btn delete-btn" disabled>delete</button>
                </div>
            </div>
            <div class="route-item">
                <div class="route-info">
                    <img src="pin.png" alt="Location" class="route-icon">
                    <div class="route-details">
                        <span class="route-name">Shopping</span>
                        <span class="route-path">Makati → Quezon City</span>
                        <span class="route-last-used">last used: 2 days ago</span>
                    </div>
                </div>
                <div class="route-actions">
                    <button class="action-btn use-btn" disabled>use</button>
                    <button class="action-btn delete-btn" disabled>delete</button>
                </div>
            </div>
        </div>

        <!-- Recent Trips Section -->
        <div class="content-section recent-trips">
            <div class="section-header">
                <img src="check.png" alt="Trips" class="section-icon">
                <h2>Recent Trips</h2>
            </div>
            <div class="trip-item">
                <div class="trip-checkbox">
                    <input type="checkbox" class="trip-check" disabled>
                </div>
                <div class="trip-info">
                    <span class="trip-route">Divisoria → Cubao</span>
                    <span class="trip-time">Today, 8:30 am</span>
                </div>
                <div class="trip-details">
                    <span class="trip-fare">P25</span>
                    <span class="trip-duration">40 mins</span>
                </div>
            </div>
            <div class="trip-item">
                <div class="trip-checkbox">
                    <input type="checkbox" class="trip-check" disabled>
                </div>
                <div class="trip-info">
                    <span class="trip-route">Makati → Quezon City</span>
                    <span class="trip-time">Yesterday, 6:15 pm</span>
                </div>
                <div class="trip-details">
                    <span class="trip-fare">P30</span>
                    <span class="trip-duration">1 hr 10 mins</span>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div class="content-section settings">
            <div class="setting-item" onclick="openSettings()">
                <img src="settings.png" alt="Settings" class="setting-icon">
                <span>Settings</span>
                <img src="right-arrow.png" alt="Arrow" class="arrow-icon">
            </div>
            <div class="setting-item sign-out" onclick="signOut()">
                <img src="logout.png" alt="Sign Out" class="setting-icon">
                <span>Sign Out</span>
                <img src="right-arrow.png" alt="Arrow" class="arrow-icon">
            </div>
        </div>
    </section>

        <script>
            // If server rendered `user` was provided, use it to populate the page immediately.
            if (typeof user !== 'undefined' && user) {
                (function() {
                    const data = - JSON.stringify(user);
                    document.getElementById('displayName').textContent = data.username || data.name || 'User';
                    document.getElementById('displayEmail').textContent = data.email || '';
                    localStorage.setItem('savedUserData', JSON.stringify({ name: data.username || data.name, email: data.email }));
                })();
                } else {
                // Fall back to API call when server didn't provide user (e.g. direct API access)
                fetch('/api/user')
                    .then(response => {
                        if (!response.ok) throw new Error('Not authenticated');
                        return response.json();
                    })
                    .then(data => {
                        document.getElementById('displayName').textContent = data.name || 'User';
                        document.getElementById('displayEmail').textContent = data.email || 'latciass....';
                        localStorage.setItem('savedUserData', JSON.stringify({ name: data.name, email: data.email }));
                    })
                    .catch(err => {
                        console.warn('Failed to fetch user data, falling back to localStorage:', err);
                        // Fallback handled by profile.js loadUserData()
                    });
                } 
        </script>
    <script src="profile.js"></script>

</body>
</html>